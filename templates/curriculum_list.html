{% extends "layout.html" %}
{% block css %}
    <style>
        .shadow {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: black;
            opacity: 0.4;
            z-index: 999;
        }

        .modal_layer {
            position: fixed;
            z-index: 1000;
            left: 50%;
            top: 50%;
            background-color: white;
            width: 400px;
            height: 150px;
            margin-top: -150px;
            margin-left: -200px;
        }
    </style>
{% endblock %}
{% block content %}
    <ol class="breadcrumb">
        <li class="active">课程管理</li>
        {#            <li class="active">添加班级信息</li>#}
    </ol>
    <div class="col-md-12" id="app">
        <el-button @click="add_curr" type="primary" style="margin-bottom: 20px;" size="mini">添加</el-button>
        <div class="shadow hide" id="shadow"></div>
        <!--学生信息展示-->
        <table class="table table-hover text-center" style="background: white;margin-bottom: 0">
            <tr>
                <th class="text-center">ID</th>
                <th class="text-center">课程名称</th>
                <th class="text-center">操作</th>
            </tr>
            {% for row in posts.object_list %}
                <tr>
                    <td>{{ row.id }}</td>
                    <td>{{ row.name }}</td>
                    <td>
                        <a href="javascript:;" @click="edit_student({{ row.id }},'{{ row.name }}')">编辑</a>
                        <a href="javascript:;" @click="del_curr({{ row.id }})">删除</a>
                    </td>
                </tr>
            {% endfor %}
        </table>
        <!--分页-->
        <nav aria-label="Page navigation" class="text-left">
            <ul class="pagination">
                {% if posts.has_previous %}
                    <li>
                        {#                        <a href="/user/student?page={{ posts.previous_page_number }}">上一页</a>#}
                        <a href="{% url 'student' %}?page={{ posts.previous_page_number }}">上一页</a>
                    </li>
                {% endif %}
                {% if posts.has_next %}
                    <li>
                        {#                        <a href="/user/student?page={{ posts.next_page_number }}">下一页</a>#}
                        <a href="{% url 'student' %}?page={{ posts.next_page_number }}">下一页</a>
                    </li>
                {% endif %}
            </ul>
        </nav>
        <!--/学生信息展示-->
        <!--添加学生信息模态框-->
        <div class="modal_layer hide" id="modal_add_student">
            <div class="panel panel-danger">
                <div class="panel-heading" style="font-weight: bold">添加学生信息
                    <button type="button" class="close" id="close_add_modal"><span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="panel-body">
                    <form>
                        <div class="form-group">
                            <label for="">姓名</label>
                            <input type="text" name="name" class="form-control" id="name" placeholder=""
                                   autofocus>
                        </div>
                        <div class="form-group">
                            <label for="">班级</label>
                            <select id="class_id" class="form-control" name="class_title">
                                {% for row in class_list %}
                                    <option value="{{ row.id }}">{{ row.title }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div id="add_student_error" style="color: red;margin-bottom: 5px"></div>
                        <input type="button" class="btn" value="添加" id="add_student" style="background: #f2dede;">
                    </form>
                </div>
            </div>
        </div>
        <el-row>
            <el-dialog
                    title="提示"
                    :visible.sync="dialogVisible"
                    width="30%"
                    :before-close="handleClose">
                <span slot="footer" class="dialog-footer">
                    <el-form ref="form" :model="form" label-width="80px">
                          <el-form-item label="课程名称">
                            <el-input v-model="form.name"></el-input>
                          </el-form-item>
                    </el-form>
                    <el-button @click="dialogVisible = false">取 消</el-button>
                    <el-button type="primary" v-if="form.id != 0 " @click="edit_curr">确定修改</el-button>
                    <el-button type="primary" v-else @click="edit_curr">确 定</el-button>
                </span>
            </el-dialog>

        </el-row>
    </div>
{% endblock %}
{% block js %}
    <script>
        window.onload = function () {
            var app = new Vue({
                delimiters: ['{', '}'],
                el: "#app",
                data: {
                    message: 'Hello Vue.js!',

                    form: {
                        id: 0,
                        name: "",
                    },
                    dialogVisible: false
                },
                methods: {
                    edit_student(id, name) {
                        this.form.id = id;
                        this.form.name = name;
                        this.dialogVisible = true
                    },
                    add_curr() {
                        this.form.id = 0;
                        this.dialogVisible = true;
                    },
                    handleClose() {
                        this.dialogVisible = false
                    },
                    edit_curr() {
                        $.ajax({
                            url: '/user/curriculum/',
                            type: 'POST',
                            data: this.form,
                            success: () => {
                                this.$message.success("OK");
                                this.dialogVisible = false;
                                location.reload();
                            },
                            error: () => {
                                this.$message.error("请勿填写重复的数据");
                                this.dialogVisible = false;
                                this.form.id = 0;
                                this.form.name = "";
                            }
                        });


                    },
                    del_curr(id) {
                        $.ajax({
                            url: '/user/curriculum',
                            data: {
                                id: id
                            },
                            type: 'DELETE',
                            success: () => {
                                this.$message.success("OK");
                                this.dialogVisible = false;
                                location.reload();
                            },
                            error: () => {
                                this.$message.error("请勿填写重复的数据");
                                this.dialogVisible = false;
                                this.form.id = 0;
                                this.form.name = "";
                            }
                        })
                    }
                },
                created() {
                }
            });
        }

    </script>
{% endblock %}